{% extends "base.html" %}

{% block title %}Student Dashboard - SmartQuiz{% endblock %}

{% block extra_style %}
<style>
    .stats-grid { display:flex; gap:20px; margin-bottom:40px; flex-wrap:wrap; }
    .stat-card { flex:1; background:white; padding:25px; border-radius:10px; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.1); transition:0.3s; }
    .stat-card:hover { transform:translateY(-4px); box-shadow:0 8px 16px rgba(0,0,0,0.2); }
    .stat-card h3 { font-size:24px; color:#007bff; margin:10px 0; }
    .stat-card p { font-size:16px; color:#666; margin:0; }
    .actions-grid { display:flex; flex-wrap:wrap; gap:20px; margin-bottom:40px; }
    .action-card { flex:1; min-width:220px; background:white; border-radius:12px; padding:20px; text-align:center; box-shadow:0 2px 6px rgba(0,0,0,0.1); text-decoration:none; color:#333; font-weight:500; transition:0.3s; }
    .action-card:hover { transform:translateY(-4px); box-shadow:0 8px 16px rgba(0,0,0,0.2); }
    table { border-collapse: collapse; width:100%; background:white; margin-bottom:40px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    th, td { border:1px solid #ddd; padding:10px; text-align:left; }
    th { background:#007bff; color:white; }
    tr:nth-child(even) { background:#f9f9f9; }
    .btn-edit { padding:6px 12px; background:#3b82f6; color:white; border-radius:6px; text-decoration:none; margin-right:5px; font-weight:600; }
    .btn-edit:hover { background:#2563eb; }
    .btn-delete { padding:6px 12px; background:#dc3545; color:white; border-radius:6px; text-decoration:none; font-weight:600; }
    .btn-delete:hover { background:#b02a37; }
    @media(max-width:768px){ .stats-grid,.actions-grid{flex-direction:column;} }
</style>
<script>
    // This script explicitly prevents the browser from loading the page from BFCache (Back/Forward Cache).
    // It forces a full page reload when navigating history, which ensures the server-side 
    // session check (in Flask) always runs, forcing a redirect to login if the session is gone.
    window.addEventListener('pageshow', function (event) {
        if (event.persisted) {
            window.location.reload();
        }
    });
</script>
{% endblock %}

{% block content %}
<div class="container">
    <h1>Student Dashboard</h1>

    <div class="stats-grid">
        <div class="stat-card">
            <h3>{{ quizzes|length }}</h3>
            <p>Available Quizzes</p>
        </div>
        <div class="stat-card">
            <h3>{{ results|length }}</h3>
            <p>Quizzes Completed</p>
        </div>
        <div class="stat-card">
            <h3>{{ avg_percent }}%</h3>
            <p>Average Score</p>
        </div>
        <div class="stat-card">
            <h3>{{ results|length }}</h3>
            <p>Total Attempts</p>
        </div>
    </div>

    <h2 class="section-title">Quick Actions</h2>
    <div class="actions-grid">
        <a href="{{ url_for('student_dashboard') }}" class="action-card">
            <div class="action-title">Browse Quizzes</div>
            <div class="action-description">See all available quizzes</div>
        </a>
        <a href="{{ url_for('student_dashboard') }}" class="action-card">
            <div class="action-title">My Results</div>
            <div class="action-description">View quiz results and details</div>
        </a>
        <a href="{{ url_for('student_analytics') }}" class="action-card">
            <div class="action-title">Analytics</div>
            <div class="action-description">Personal & course analytics</div>
        </a>
    </div>


    <h2 class="section-title">Available Quizzes</h2>
    {% if quizzes %}
    <table>
        <thead>
            <tr>
                <th>Quiz Title</th>
                <th>Description</th>
                <th>Duration</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for quiz in quizzes %}
            <tr>
                <td><strong>{{ quiz['title'] }}</strong></td>
                <td>{{ quiz['description'][:100] if quiz['description'] else 'N/A' }}...</td>
                <td>{{ quiz['duration'] }} min</td>
                <td><a href="{{ url_for('take_quiz', quiz_id=quiz['id']) }}" class="btn-edit">Take Quiz</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div style="background:white; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1);">
        <p>No quizzes available yet.</p>
    </div>
    {% endif %}

    <h2 class="section-title">My Results</h2>
    {% if results %}
    <table>
        <thead>
            <tr>
                <th>Quiz ID</th>
                <th>Score</th>
                <th>Total Questions</th>
                <th>Percentage</th>
                <th>Completed</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for result in results %}
            <tr>
                <td>{{ result['quiz_id'] }}</td>
                <td><strong>{{ result['score'] }}</strong></td>
                <td>{{ result['total_questions'] }}</td>
                <td>
                    {% if result['total_questions'] > 0 %}
                        {% if result['score'] >= result['total_questions'] * 0.7 %}
                            <span style="color:#28a745; font-weight:600;">{{ (result['score'] / result['total_questions'] * 100)|round(1) }}%</span>
                        {% elif result['score'] >= result['total_questions'] * 0.5 %}
                            <span style="color:#ffc107; font-weight:600;">{{ (result['score'] / result['total_questions'] * 100)|round(1) }}%</span>
                        {% else %}
                            <span style="color:#dc3545; font-weight:600;">{{ (result['score'] / result['total_questions'] * 100)|round(1) }}%</span>
                        {% endif %}
                    {% else %}
                        <span style="color:#999; font-weight:600;">N/A</span>
                    {% endif %}
                </td>
                <td>{{ result['completed_at'] }}</td>
                <td><a href="{{ url_for('view_result', result_id=result['id']) }}" class="btn-edit">View Details</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div style="background:white; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1);">
        <p>You haven't completed any quizzes yet.</p>
    </div>
    {% endif %}



</div>
{% endblock %}
