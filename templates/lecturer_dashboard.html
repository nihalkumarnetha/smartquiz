{% extends "base.html" %}

{% block title %}Lecturer Dashboard - SmartQuiz{% endblock %}

{% block extra_style %}<style>
    .stats-grid { display:flex; gap:20px; margin-bottom:40px; flex-wrap:wrap; }
    .stat-card { flex:1; background:white; padding:25px; border-radius:10px; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.1); transition:0.3s; }
    .stat-card:hover { transform:translateY(-4px); box-shadow:0 8px 16px rgba(0,0,0,0.2); }
    .stat-card h3 { font-size:24px; color:#007bff; margin:10px 0; }
    .stat-card p { font-size:16px; color:#666; margin:0; }
    .actions-grid { display:flex; flex-wrap:wrap; gap:20px; margin-bottom:40px; }
    .action-card { flex:1; min-width:220px; background:white; border-radius:12px; padding:20px; text-align:center; box-shadow:0 2px 6px rgba(0,0,0,0.1); text-decoration:none; color:#333; font-weight:500; transition:0.3s; }
    .action-card:hover { transform:translateY(-4px); box-shadow:0 8px 16px rgba(0,0,0,0.2); }
    table { border-collapse: collapse; width:100%; background:white; margin-bottom:40px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    th, td { border:1px solid #ddd; padding:10px; text-align:center; }
    th { background:#007bff; color:white; }
    tr:nth-child(even) { background:#f9f9f9; }
    .btn-edit { padding:6px 12px; background:#3b82f6; color:white; border-radius:6px; text-decoration:none; margin-right:5px; font-weight:600; }
    .btn-edit:hover { background:#2563eb; }
    .btn-delete { padding:6px 12px; background:#dc3545; color:white; border-radius:6px; text-decoration:none; font-weight:600; }
    .btn-delete:hover { background:#b02a37; }
    @media(max-width:768px){ .stats-grid,.actions-grid{flex-direction:column;} }
</style>
<script>
    // This script explicitly prevents the browser from loading the page from BFCache (Back/Forward Cache).
    // It forces a full page reload when navigating history, which ensures the server-side 
    // session check (in Flask) always runs, forcing a redirect to login if the session is gone.
    window.addEventListener('pageshow', function (event) {
        if (event.persisted) {
            window.location.reload();
        }
    });
</script>
{% endblock %}

{% block content %}
<div class="container">
    <h1>Lecturer Dashboard</h1>

    <div class="stats-grid">
        <div class="stat-card">
            <h3>{{ quizzes|length }}</h3>
            <p>Quizzes Created</p>
        </div>
        <div class="stat-card">
            <h3>{{ total_questions }}</h3>
            <p>Total Questions</p>
        </div>
        <div class="stat-card">
            <h3>{{ total_students }}</h3>
            <p>Students Attempted</p>
        </div>
        <div class="stat-card">
            <h3>{{ quizzes|length }}</h3>
            <p>Active Quizzes</p>
        </div>
    </div>

    <h2 class="section-title">Quick Actions</h2>
    <div class="actions-grid">
        <a href="{{ url_for('create_quiz') }}" class="action-card">
            <div class="action-title">Create New Quiz</div>
            <div class="action-description">Start a new quiz and add questions</div>
        </a>
        <a href="{{ url_for('lecturer_students') }}" class="action-card">
            <div class="action-title">Analytics</div>
            <div class="action-description">View quiz & student analytics</div>
        </a>
    </div>


    <h2 class="section-title">My Quizzes</h2>
    {% if quizzes %}
    <table>
        <thead>
            <tr>
                <th>Quiz Title</th>
                <th>Description</th>
                <th>Questions</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for quiz in quizzes %}
            <tr>
                <td><strong>{{ quiz['title'] }}</strong></td>
                <td>{{ quiz['description'][:100] if quiz['description'] else 'N/A' }}...</td>
                <td>
                    {% set q_count = namespace(count=0) %}
                    {% for q in quizzes %}
                        {% if q.id == quiz.id %}
                            {{ total_questions }}
                        {% endif %}
                    {% endfor %}
                </td>
                <td>
                    <a href="{{ url_for('add_questions', quiz_id=quiz['id']) }}" class="btn-edit">Edit</a>
                    <form action="{{ url_for('delete_quiz', quiz_id=quiz['id']) }}" method="post" style="display:inline-block; margin-left:8px;">
                        <button type="submit" class="btn-delete" onclick="return confirm('Delete this quiz? This action cannot be undone.');">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div style="background:white; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1);">
        <p>You haven't created any quizzes yet. <a href="{{ url_for('create_quiz') }}">Create one now!</a></p>
    </div>
    {% endif %}

    

</div>
{% endblock %}
